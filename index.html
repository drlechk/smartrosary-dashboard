<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<title>SmartRosary ‚Äî Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="header-with-lang">
    <h1 id="titleTxt">SmartRosary ‚Äî Dashboard</h1>
    <select id="langSelect">
      <option value="pl">PL</option>
      <option value="en">EN</option>
      <option value="de">DE</option>
    </select>
  </header>

  <div class="toolbar-wrap">
    <div class="toolbar">
      <button id="connectBtn">Connect</button>
      <button id="refreshBtn" disabled>Refresh</button>
      <button id="disconnectBtn" disabled>Disconnect</button>
    </div>
  </div>

  <div id="status">Not connected.</div>

  <section class="wrap">
    <div class="grid">
      <div class="card">
        <h3 id="overviewTitle">Overview</h3>
        <div class="kpis" style="grid-template-columns:repeat(3,1fr);">
          <div class="kpi"><div class="label" id="lblBeads">Beads</div><div class="value" id="kpiBeads">‚Äî</div></div>
          <div class="kpi"><div class="label" id="lblDecades">Decades</div><div class="value" id="kpiDecades">‚Äî</div></div>
          <div class="kpi"><div class="label" id="lblRosaries">Rosaries</div><div class="value" id="kpiRosaries">‚Äî</div></div>
          <div class="kpi"><div class="label" id="lblChaplets">Chaplets</div><div class="value" id="kpiChaplets">‚Äî</div></div>
        </div>
        <div class="flex" style="margin-top:12px;">
          <span class="pill" id="pillDevice"><span id="lblDevice">Device</span>: <span id="valDevice">‚Äî</span></span>
          <span class="pill" id="pillFW"><span id="lblFW">FW</span>: <span id="valFW">‚Äî</span></span>
          <span class="pill" id="pillLastMystery"><span id="lblLastMystery">Last mystery</span>: <span id="valLastMystery">‚Äî</span></span>
        </div>
        <p class="smallnote" id="bkNote"></p>
        <h3 id="lblBackupRestore">Backup & Restore</h3>
        <div class="row">
          <button id="backupBtn"  disabled>Download</button>
          <input type="file" id="restoreFile" accept="application/json" style="display:none">
          <button id="restoreBtn" disabled>Restore</button>
          <button id="resetBtn" disabled>Reset Statistics</button>
          <progress id="restoreProg" max="100" value="0" hidden></progress>
        </div>

        <div class="row">
          <button id="keysBackupBtn"  disabled>Download Keys</button>
          <input type="file" id="keysRestoreFile" accept="application/json" style="display:none">
          <button id="keysRestoreBtn" disabled>Restore Keys</button>
        </div>
      </div>

      <div class="card">
        <h3 id="settingsTitle">Settings</h3>
        <div class="settings-list">
          <div class="setting">
            <div class="meta">
              <span class="title" id="lblPreset">Start with preset mystery</span>
              <span class="desc"  id="descPreset">Begin rosary on a chosen set (disables autosave).</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="swPreset" disabled>
              <span class="slider"></span>
            </label>
          </div>
          <div class="setting">
            <div class="meta">
              <span class="title" id="lblAutosave">Autosave last state</span>
              <span class="desc"  id="descAutosave">Continue where you left off.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="swAutosave" disabled>
              <span class="slider"></span>
            </label>
          </div>
          <div class="setting">
            <div class="meta">
              <span class="title" id="lblHaptic">Haptic feedback</span>
              <span class="desc"  id="descHaptic">Vibration on key/bead events.</span>
            </div>
            <label class="switch">
              <input type="checkbox" id="swHaptic" disabled>
              <span class="slider"></span>
            </label>
          </div>
          <div class="setting" style="display:flex; justify-content:space-between; align-items:center;">
            <div class="meta">
              <span class="title" id="lblDispBright">Display brightness</span>
              <span class="desc"  id="descDispBright">Adjust screen backlight (0‚Äì100).</span>
            </div>
            <div style="display:flex; align-items:center; gap:10px;">
              <input id="slDispBright" type="range" min="0" max="100" step="1" value="0" disabled style="width:140px;">
              <span id="slDispBrightVal" class="pill" style="min-width:48px; text-align:center;">0%</span>
            </div>
          </div>
          <div class="setting" style="display:flex; justify-content:space-between; align-items:center;">
            <div class="meta">
              <span class="title" id="lblWallBright">Wallpaper brightness</span>
              <span class="desc"  id="descWallBright">Adjust background image opacity.</span>
            </div>
            <div style="display:flex; align-items:center; gap:10px;">
              <input type="range" id="slWallBright" min="0" max="100" value="0" disabled style="width:140px" />
              <span id="wallBrightVal" class="pill" style="min-width:48px; text-align:center;">0%</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 id="avgTitle">Durations & Averages</h3>
         <div class="kpis" style="grid-template-columns:repeat(3,1fr);">
          <div class="kpi"><div class="label" id="lblAvgBead">Avg bead</div><div class="value" id="kpiAvgBead">‚Äî</div></div>
          <div class="kpi"><div class="label" id="lblAvgDecade">Avg decade</div><div class="value" id="kpiAvgDecade">‚Äî</div></div>
          <div class="kpi"><div class="label" id="lblAvgRosary">Avg rosary</div><div class="value" id="kpiAvgRosary">‚Äî</div></div>
          <div class="kpi"><div class="label" id="lblAvgChaplet">Avg chaplet</div><div class="value" id="kpiAvgChaplet">‚Äî</div></div>
        </div>
        <p class="smallnote" id="avgNote">Averages are computed from lifetime device totals.</p>
        <h3 id="totalsTitle">Totals (time)</h3>
        <div class="kpis" style="grid-template-columns:repeat(3,1fr);">
          <div class="kpi"><div class="label" id="lblTrosary">Rosary</div><div class="value" id="totRosary">‚Äî</div></div>
          <div class="kpi"><div class="label" id="lblTdecades">Decades</div><div class="value" id="totDecade">‚Äî</div></div>
          <div class="kpi"><div class="label" id="lblTbeads">Beads</div><div class="value" id="totBead">‚Äî</div></div>
          <div class="kpi"><div class="label" id="lblTchaplet">Chaplet</div><div class="value" id="totChaplet">‚Äî</div></div>
        </div>
      </div>

      <div class="card">
        <h3 id="barTitle">Average durations (s)</h3>
        <div class="chart"><canvas id="barWindow"></canvas></div>
      </div>

      <div class="card">
        <h3 id="donutTitle">Mystery Sets Breakdown</h3>
        <div class="chart"><canvas id="donutSets"></canvas></div>
      </div>

      <div class="card">
        <h3 id="partsTitle">Mystery Parts (I‚ÄìV per set)</h3>
        <div class="chart"><canvas id="partsChart"></canvas></div>
      </div>

<!-- Wallpaper / SPIFFS Explorer -->
<div class="card wp-muted" id="wpCard">
  <div class="wp-header">
    <h3 id="wpTitle">Wallpaper</h3>
  </div>

  <!-- Files table -->
<div id="wpFilesPanel" class="wp-files-panel" style="display:none">
  <table class="files">
    <thead>
      <tr>
        <th class="name">File</th>
        <th class="size">Size</th>
        <th class="actions">Actions</th>
      </tr>
    </thead>
    <tbody id="wpFiles"></tbody>
  </table>
</div>

  <!-- Round preview canvas -->
<div class="wp-canvas-wrap">
  <div class="wp-canvas-shell muted">
    <canvas id="wpCanvas" width="240" height="240"></canvas>
  </div>
</div>

  <!-- Actions -->
<div class="wp-actions">
<button id="wpSelectBtn">Select file‚Ä¶</button>
<input id="wpFileInput" type="file"
       accept=".bin,.rgb565,.565,.raw,image/png,image/jpeg,image/webp"
       style="display:none">

<button id="wpUploadBtn" disabled>Upload</button>
<select id="wpPresetSelect" style="min-width:180px">
  <option value="">‚Äî Preset ‚Äî</option>
</select></br>
<div>
  <button id="wpSaveBinBtn" class="pill" hidden>Save .bin</button>
  <button id="wpSavePngBtn" class="pill" hidden>Save .png</button>
</div>

</div>

<div id="wpFullMsg" class="muted" style="display:none; margin-top:6px; text-align:center;">
  üö´ Storage full (6/6) ‚Äî delete one on the device first.
</div>

  <!-- Progress -->
<div class="wp-progress">
  <progress id="wpProg" max="100" value="0"></progress>
  <div id="wpProgText" class="muted"></div>
</div>
</div>
   

      <div class="card">
        <h3 id="rcTitle">Remote control</h3>
        <div class="remote-wrap">
          <div class="canvas-shell">
            <canvas id="lvgl_canvas" width="320" height="320" aria-label="Round touch surface"></canvas>
          </div>
          <div class="dpad" role="group" aria-label="LVGL directions + center">
            <div class="empty"></div>
            <button id="btnUp"    aria-label="Top">‚ñ≤</button>
            <div class="empty"></div>

            <button id="btnLeft"  aria-label="Left">‚óÄ</button>
            <button id="btnCenter" class="center" aria-label="Center">‚óè</button>
            <button id="btnRight" aria-label="Right">‚ñ∂</button>

            <div class="empty"></div>
            <button id="btnDown"  aria-label="Bottom">‚ñº</button>
            <div class="empty"></div>
          </div>
          <div id="rcStatus">Touch + D-pad will activate after connecting.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Your modules -->
  <script type="module" src="./js/main.js"></script>
  <script src="https://lib.arvancloud.ir/nosleep/0.9.0/NoSleep.min.js"></script>
  <script>
        // Wake lock
      let wakeLock = null;
      async function enableWakeLock() {
        try { if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); }
        catch (err) { console.warn('WakeLock error:', err); }
      }
      const noSleep = new NoSleep();
      function preventStandby(){ enableWakeLock(); try{ noSleep.enable(); }catch{} }
  </script>
</body>
</html>
